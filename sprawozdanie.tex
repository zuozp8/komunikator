\documentclass[10pt,a4paper]{article}
\usepackage{fullpage}
\usepackage{polski}
\usepackage[utf8x]{inputenc}
\usepackage{ucs}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}

\newcommand{\kod}[1]{\textbf{\small{KOD: #1}}}

\author{Konrad Baumgart, Jan Borowski}
\title{Projekt SK}

\begin{document}

\maketitle

\section{Treść zadania}
	Projekt 4: Komunikator internetowy typu GG

\section{Protokół sieciowy}
	Każdy klient identyfikowany jest przez swój 2-bajtowy dodatni numer ID, używa swojego hasła do logowania.\\
	Użytkownik ma tylko 2 statusy: zalogowany i niezalogowany.
	
	\paragraph{Logi}
		Serwer wypisuje dane diagnostyczne na standardowe wyjście błędów.
	\paragraph{Zapewnienie odczytu pełnych paczek z danymi}
		Za każdym razem zarówno serwer jak i klient poprzedza przesyłane dane
		informacją o ich długości (w bajtach) zawartą w 2 bajtach. Nie wlicza się w tę długość
		2 bajtów przechowujących ilość danych.
		Ogranicza to na przykład maksymalną	długość wiadomości w systemie.\\
		Pierwszą częścią danych jest zawsze kod operacji o długości 1 bajta.
	\paragraph{Postępowanie w przypadku otrzymania nieprawidłowych danych}
		Gdy serwer otrzyma od klienta dane niezgodne z niniejszą specyfikacją, rozłącza danego klienta.
	\paragraph{Port serwera} Serwer nasłuchuje pakietów TCP na porcie 4790.
	\paragraph{Łączenie} Nawiązując połączenie z serwerem klient może albo się zarejestrować, albo zalogować.
	\paragraph{Rejestracja}\kod{1}\\
		Można się rejestrować jedynie tuż po nawiązaniu połączenia.
		Klient przesyła swoje hasło zakończone \textbackslash{}0.
		Serwer odpowiada \kod{1} wysyłając 2 bajty: numer ID w przypadku sukcesu lub 0 w przypadku błędu,
		następnie rozłącza się.
	\paragraph{Logowanie}\kod{2}\\
		Klient wysyła swoje ID (2 bajty) do serwera, po nim zaś swoje hasło zakończone \textbackslash{}0.
		Serwer odpowiada \kod{2} wysyłając 1 bajt: 1 w przypadku sukcesu lub 0 w przypadku błędu.\\
	\paragraph{Zakończenie połączenia} Zarówno klient jak i serwer mogą zakończyć połączenie po prostu
		kończąc połączenie TCP.
	
	\paragraph{} \textbf{Poniższe komendy można wykonać tylko będąc zalogowanym.}
	\paragraph{Sprawdzenie dostępności znajomych}\kod{3}\\
		Klient wysyła kilka ID (2-bajtowe, jedno po drugim) do serwera.
		Serwer odpowiada \kod{3} wysyłając wielokrotność 3 bajtów: dla każdego ID o które wystosowano zapytanie
		2 bajty zajmuje to ID, zaś w trzecim bajcie jest kod dostępności danego użytkownika.\\
		Można sprawdzić dostępność samego siebie.
	\paragraph{Wysłanie wiadomości}\kod{5}\\
		Klient wysyła nieujemną ilość osób $n$ (1 bajt) do których wysyła wiadomość. Następnie wysyła $2n$ bajtów -
		ID odbiorców.\\
		Serwer nie informauje nadawce o powodzeniu operacji wysłania.\\
		Serwer wysyła \kod{5} do odbiorców nieujemną ilość osób $n$ (1 bajt) do których wysyłana jest wiadomość.
		Następnie wysyła $2$ bajty - ID nadawcy, oraz $2(n-1)$ bajtów - ID innych odbiorców.\\
		Dzieki temu klient wie, że wiadomość wysłana jest w konferencji.\\
		Jeżeli odbiorca jest niezalogowany, wiadomości do niego są przechowywane na serwerze
		i są mu przesyłane w momencie gdy się zaloguje.
\section{Realizacja}
	\paragraph{Serwer}Stworzyliśmy serwer używając poznanych na zajęciach socketów BSD używając języka C++.
	By przechowywać dane o użytkownikach, używamy dynamicznych kontenerów z STL.
	Kod serwera jest krótki, więc pozwoliliśmy sobie go zamknąć w pojedynczym pliku \textit{main.cpp}.
	\begin{quote}
		\textit{Code is the ultimate documentation.}
	\end{quote}
	\subparagraph{Wielowątkowość}Mieliśmy problem z wieloątkowością - gdybyśmy dla każdego połączenia tworzyli
	nowy wątek, to z tegoż nowego wątku nie moglibyśmy bezpośrednio wysyłać wiadomości do użytkowników, którzy
	się zalogowali po nas - nie mielibyśmy dostępu do gniazd dla nich stworzonych. Dlatego nie tworzyliśmy nowych
	wątków, a użyliśmy funckji \textit{select} by oczekiwać na możliwość odczytu lub zapisu do wielu gniazd.
		
	\paragraph{Klient}Klienta stworzyliśmy w języku Java, gdyż byliśmy w stanie potem uruchamić go w środowisku
	Linux oraz Windows, a także stworzyć wersję dla urządzenia mobilnego z systemem Android.
	
\section{Obsługa programu}
	\subsection{Serwer}
		Skompilowany przy (użyciu programu make) serwer uruchamia się w konsoli.
		Po uruchomieniu można obserwować wyjście diagnostyczne na standardowym wyjściu błędów.
		By łagodnie wyłączyc serwer wystarczy wysłać doń SIGUSR1.
	\subsection{Klient}
		Klient uruchamiany jest na maszynie wirtualnej Java.
		Intuicyjny graficzny interfejs użytkownika pozwala zarejestrować się, zalogować i kożystać z komunikatora.

\end{document}